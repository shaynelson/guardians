<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Guardians</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --bg:#261c1c; --card:#172946; --accent:#1fb6ff; --muted:#14c3cc; --text:#ffffff;
  }
  html,body{
    height:100%;margin:0;font-family:Inter,Segoe UI,Arial;background-image: url(arena.webp);background-repeat:no-repeat;
    background-size: cover;background-attachment:fixed;color:var(--text)
}
  .wrap{
    max-width:90%;margin:20px auto;padding:20px
}
  header{
    display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px
}
  h1{
    font-size:60px;margin:0;
}
  .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 8px 12px rgba(72, 236, 239, 0.6)}
  .small{font-size:18px;color:var(--muted)}
  .controls{display:flex;gap:8px;align-items:center}
  table{
    width:100%;border-collapse:collapse;margin-top:12px
  }
  th,td{
    padding:8px 10px;text-align:center;border-bottom:1px solid rgba(244, 0, 0, 0.04);font-size:18px;vertical-align:middle
  }
  th{
    color:var(--muted);font-weight:600
  }
  .team-cell{font-size:12px;color:var(--muted);white-space:nowrap;overflow:scroll;text-overflow:hide;max-width:760px}
  .rank{font-weight:700;color:var(--accent);width:48px}
  .spark{width: 120px;px;height:36px}
  .layout{display:grid;grid-template-columns:1fr;gap:16px}
  .chart-area{height:360px}
  .btn{background:var(--accent);border:none;color:#04202b;padding:8px 10px;border-radius:8px;cursor:pointer}
  tr.clickable{cursor:pointer}
  tr.clickable:hover{background:rgba(31,182,255,0.03)}
  footer{margin-top:18px}
  @media (min-width:980px){
    .layout{grid-template-columns:1fr 420px}
    .chart-area{height:420px}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1 class="card">Beijing Guardians Stat Block</h1>
    <div class="controls">
      <label class="small">Sort by</label>
      <select id="sortBy" class="card" style="color: #1fb6ff;"padding:6px;border-radius:8px">
        <option value="gaa">GAA</option>
        <option value="gp">Games Played</option>
        <option value="winPct">Win Percentage</option>
      </select>
      <button id="reset" class="btn">Reset</button>
    </div>
  </header>

  <section class="card" style="margin-bottom:12px;display:float;justify-content:space-between;align-items:center; text-align: center;">
    <div>
      <div style="font-size:x-large;"><strong>Sunday Line-Up</strong></div>
      <div class="small" style="font-size: x-large;"><strong>November 30th</strong></div>
      <div class="small" style="margin-top:9px; text-align: center; font-size: xx-large;">
        G1. <strong>Ray</strong> / Wings vs Oilers / <strong>Shay</strong> <br> 
        G2. <strong>Aken</strong> / Revs vs Bears / <strong>Moose</strong> <br>
        G3. <strong>JY</strong> / Bulls vs Expos / <strong>Ray</strong>
      </div>
    </div>
  </section>

  <section class="card" style="margin-bottom:12px;display:flex;justify-content:space-between;align-items:left">
    <div>
      <div><strong>Total Goalies:</strong> <span id="totalGoalies">0</span></div>
      <div class="small">Ranking defaults to lowest GAA = best rank. Click a row to highlight that goalie on the group chart below.</div>
    </div>
    <div class="small">Through Week: <strong>10</strong></div>
  </section>

  <div class="card" style="overflow:auto">
    <table id="goalieTable" aria-label="Goalie statistics">
      <thead>
        <tr>
          <th class="rank">Rank</th>
          <th>Goalie</th>
          <th>GAA</th>
          <th>GP</th>
          <th>Win %</th>
          <th>Games by Team (7)</th>
          <th>Last 10 GAA</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="layout" style="margin-top:14px">
    <div class="card chart-area">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>Group Trend — Last 10 Games GAA (all goalies)</strong>
          <div class="small">Each line is a goalie; click a table row to highlight a single goalie.</div>
        </div>
        <div style="display:flex;gap:8px">
          <button id="showAll" class="btn">Show All</button>
          <button id="hideAll" class="btn">Hide All</button>
        </div>
      </div>
      <canvas id="groupChart" style="margin-top:12px;width:100%;height:100%"></canvas>
    </div>

    <div class="card" style="padding:12px;max-height:420px;overflow:auto">
      <strong>Legend & Controls</strong>
      <div id="legendContainer" style="margin-top:8px"></div>
      <div class="small" style="margin-top:10px">If goalie hasn't played 10 games; data will be incomplete.</div>
    </div>
  </div>

  <footer class="card" style="margin-top:18px">
    <div class="small">GAA formula: <strong>GAA = (Goals Against × 60) / Minutes Played</strong>. Games Played = wins + losses + ties. Win % = wins / gamesPlayed × 100.</div>
  </footer>
</div>

<script>
/* Teams (7) */
const teams = ["Warriors","Expos","Oilers","Bulls","Hot Wings","Bears","Revs"];

/* 9 goalies dataset
   - goalsAgainst and minutes compute overall GAA
   - gamesByTeam: 7 numbers
   - last10GAA: array of 10 numbers (older → recent)
*/
const goalies = [
  {name:"Shay", goalsAgainst:44, minutes:660, wins:6, losses:5, ties:0, gamesByTeam:[1,0,2,2,0,4,2],
   last10GAA:[5,4,2,6,1,4,5,4,8,0]},
  {name:"Olli", goalsAgainst:38, minutes:660, wins:8, losses:3, ties:0, gamesByTeam:[2,2,22,1,2,1,1],
   last10GAA:[4,4,3,4,4,4,2,2,3,5]},
  {name:"Ray", goalsAgainst:72, minutes:780, wins:4, losses:9, ties:0, gamesByTeam:[2,2,2,1,1,3,2],
   last10GAA:[2,4,7,3,4,8,12,3,6,6]},
  {name:"JY", goalsAgainst:61, minutes:660, wins:6, losses:5, ties:0, gamesByTeam:[1,2,1,2,4,1,0],
   last10GAA:[5,9,6,4,9,7,3,5,4,5]},
  {name:"Aken", goalsAgainst:32, minutes:240, wins:0, losses:4, ties:0, gamesByTeam:[1,1,0,0,0,0,2],
   last10GAA:[0,0,0,0,0,0,11,9,6,6]},
  {name:"Tomasz", goalsAgainst:21, minutes:180, wins:1, losses:2, ties:0, gamesByTeam:[1,0,1,1,0,0,0],
   last10GAA:[0,0,0,0,0,0,0,9,4,8,]},
  {name:"Rich", goalsAgainst:6, minutes:120, wins:1, losses:1, ties:0, gamesByTeam:[0,0,0,0,0,0,2],
   last10GAA:[0,0,0,0,0,0,0,0,2,4]},
  {name:"Neil", goalsAgainst:7, minutes:60, wins:1, losses:0, ties:0, gamesByTeam:[0,1,0,0,0,0,0],
   last10GAA:[0,0,0,0,0,0,0,0,0,7]},
  {name:"Moose", goalsAgainst:20, minutes:180, wins:2, losses:1, ties:0, gamesByTeam:[1,0,1,0,1,0,0],
   last10GAA:[0,0,0,0,0,0,0,9,8,3]}
];

/* Compute derived stats */
function computeStats(g){
  const gp = g.wins + g.losses + g.ties;
  const gaa = g.minutes > 0 ? (g.goalsAgainst * 60) / g.minutes : 0;
  const winPct = gp > 0 ? (g.wins / gp) * 100 : 0;
  return { gp, gaa: +gaa.toFixed(2), winPct: +winPct.toFixed(1) };
}

/* Render table with sparklines */
function renderTable(sortKey='gaa'){
  const tbody = document.querySelector('#goalieTable tbody');
  tbody.innerHTML = '';
  const enriched = goalies.map(g => ({...g, ...computeStats(g)}));

  enriched.sort((a,b)=>{
    if(sortKey === 'gaa') return a.gaa - b.gaa;            // lower GAA first
    if(sortKey === 'gp') return b.gp - a.gp;              // more games first
    if(sortKey === 'winPct') return b.winPct - a.winPct;  // higher win% first
    return a.gaa - b.gaa;
  });

  document.getElementById('totalGoalies').textContent = enriched.length;

  enriched.forEach((g, i) => {
    const teamText = teams.map((t, idx) => `${t}:${g.gamesByTeam[idx]}`).join(' ; ');
    const tr = document.createElement('tr');
    tr.className = 'clickable';
    tr.dataset.name = g.name;
    tr.innerHTML = `
      <td class="rank">${i+1}</td>
      <td><strong>${g.name}</strong></td>
      <td>${g.gaa}</td>
      <td>${g.gp}</td>
      <td>${g.winPct}%</td>
      <td class="team-cell" title="${teamText}">${teamText}</td>
      <td><canvas id="spark-${g.name.replace(/\s+/g,'-')}" class="spark"></canvas></td>
    `;
    tr.addEventListener('click', () => highlightOnGroupChart(g.name));
    tbody.appendChild(tr);
  });

  // After DOM rows created, draw sparklines
  enriched.forEach(g => drawSparkline(g));
}

/* Draw small sparkline for a goalie */
function drawSparkline(g){
  const id = 'spark-' + g.name.replace(/\s+/g,'-');
  const canvas = document.getElementById(id);
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  // destroy existing chart instance if present
  if(canvas._chart) canvas._chart.destroy();
  canvas._chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: Array.from({length: g.last10GAA.length}, (_,i) => i+1),
      datasets: [{
        data: g.last10GAA,
        borderColor: '#1fb6ff',
        backgroundColor: 'rgba(31,182,255,0.12)',
        tension: 0.3,
        pointRadius: 0,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      elements: { line: { borderWidth: 1.5 } },
      scales: { x: { display:false }, y: { display:false } },
      plugins: { legend: { display:false }, tooltip: { enabled:false } }
    }
  });
}

/* Group chart: one line per goalie */
let groupChart = null;
const groupCtx = document.getElementById('groupChart').getContext('2d');

/* Color palette */
const palette = ['#1fb6ff','#ff7ab6','#7afcff','#ffb86b','#b28cff','#7bd389','#ffd166','#8ecae6','#ff6b6b'];

function buildGroupDatasets(){
  return goalies.map((g, idx) => {
    const stats = computeStats(g);
    return {
      label: g.name + ` (GAA ${stats.gaa})`,
      data: g.last10GAA,
      borderColor: palette[idx % palette.length],
      backgroundColor: palette[idx % palette.length] + '22',
      tension: 0.25,
      pointRadius: 3,
      fill: false,
      metaName: g.name,
      borderWidth: 2,
      hidden: false
    };
  });
}

function createGroupChart(){
  const labels = Array.from({length:10}, (_,i) => `G${i+1}`);
  const datasets = buildGroupDatasets();
  if(groupChart) groupChart.destroy();
  groupChart = new Chart(groupCtx, {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      scales: {
        y: { title: {display:true, text:'GAA'}, beginAtZero:false },
        x: { title: {display:true, text:'Game (older → recent)'} }
      },
      plugins: {
        legend: { display:false },
        tooltip: { mode:'index', intersect:false }
      }
    }
  });
  renderLegend();
}

/* Custom legend with toggle & highlight */
function renderLegend(){
  const container = document.getElementById('legendContainer');
  container.innerHTML = '';
  groupChart.data.datasets.forEach((ds, i) => {
    const avg = (ds.data.reduce((a,b)=>a+b,0)/ds.data.length).toFixed(2);
    const row = document.createElement('div');
    row.style.display = 'flex';
    row.style.alignItems = 'center';
    row.style.justifyContent = 'space-between';
    row.style.padding = '6px';
    row.style.borderBottom = '1px solid rgba(255,255,255,0.02)';
    row.innerHTML = `
      <div style="display:flex;align-items:center;gap:10px">
        <div style="width:14px;height:14px;border-radius:3px;background:${ds.borderColor};opacity:${ds.hidden?0.35:1}"></div>
        <div style="min-width:160px">${ds.metaName}</div>
        <div class="small" style="color:var(--muted)">Avg ${avg}</div>
      </div>
      <div style="display:flex;gap:8px">
        <button data-idx="${i}" class="toggleBtn" style="padding:6px;border-radius:6px;background:rgba(255,255,255,0.04);border:none;color:var(--text);cursor:pointer">${ds.hidden?'Show':'Hide'}</button>
        <button data-idx="${i}" class="focusBtn" style="padding:6px;border-radius:6px;background:var(--accent);border:none;color:#04202b;cursor:pointer">Highlight</button>
      </div>
    `;
    container.appendChild(row);
  });

  container.querySelectorAll('.toggleBtn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const idx = Number(e.currentTarget.dataset.idx);
      const ds = groupChart.data.datasets[idx];
      ds.hidden = !ds.hidden;
      createGroupChart();
    });
  });
  container.querySelectorAll('.focusBtn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const idx = Number(e.currentTarget.dataset.idx);
      highlightOnGroupChart(goalies[idx].name);
    });
  });
}

/* Highlight a single goalie on the group chart (dim others) */
function highlightOnGroupChart(name){
  groupChart.data.datasets.forEach(ds => {
    if(ds.metaName === name){
      ds.borderWidth = 4;
      ds.pointRadius = 4;
      ds.hidden = false;
      // ensure solid color
      ds.borderColor = ds.borderColor.replace(/([0-9a-f]{6})([0-9a-f]{2})?$/i, '$1');
    } else {
      ds.borderWidth = 1;
      ds.pointRadius = 2;
      // dim others by appending 55 alpha if not already
      if(!ds.borderColor.endsWith('55')) ds.borderColor = ds.borderColor + '55';
      ds.hidden = false;
    }
  });
  groupChart.update();
  // highlight table row
  document.querySelectorAll('#goalieTable tbody tr').forEach(tr => {
    tr.style.background = (tr.dataset.name === name) ? 'linear-gradient(90deg, rgba(31,182,255,0.06), rgba(31,182,255,0.02))' : '';
  });
}

/* Show all / Hide all */
document.getElementById('showAll').addEventListener('click', () => {
  groupChart.data.datasets.forEach(ds => ds.hidden = false);
  createGroupChart();
});
document.getElementById('hideAll').addEventListener('click', () => {
  groupChart.data.datasets.forEach(ds => ds.hidden = true);
  createGroupChart();
});

/* Sorting controls */
document.getElementById('sortBy').addEventListener('change', e => renderTable(e.target.value));
document.getElementById('reset').addEventListener('click', () => {
  document.getElementById('sortBy').value = 'gaa';
  renderTable('gaa');
});

/* Initial render */
renderTable('gaa');
createGroupChart();

</script>
<div class="wrap">
    <div class="card" role="region" aria-label="Sports team rankings">
      <div class="header">
        <div>
          <div class="title">BIIH Standings</div>
          <div class="sub">Sorted by total points. Click a header to sort.</div>
        </div>
        <div class="controls">
          <button class="btn" id="resetSort">Reset sort</button>
          <button class="btn" id="sortPoints">Sort by Points</button>
        </div>
      </div>

      <div class="table-wrap">
        <table id="standings" aria-describedby="standingsNote">
          <thead>
            <tr>
              <th class="rank">#</th>
              <th>
                <button data-key="team">
                  Team <span class="dir" aria-hidden="true"></span>
                </button>
              </th>
              <th>
                <button data-key="wins">
                  Wins <span class="dir" aria-hidden="true"></span>
                </button>
              </th>
              <th>
                <button data-key="losses">
                  Losses <span class="dir" aria-hidden="true"></span>
                </button>
              </th>
              <th>
                <button data-key="otWins">
                  OT wins <span class="dir" aria-hidden="true"></span>
                </button>
              </th>
              <th>
                <button data-key="points">
                  Points <span class="dir" aria-hidden="true"></span>
                </button>
              </th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows injected by script -->
          </tbody>
        </table>
      </div>

      <div id="standingsNote" class="note">
        2 per win, 1 per OT win. Losses yield 0.
      </div>
    </div>
  </div>

  <script>
    // Example data — replace or load dynamically
    const data = [
      { team: "Hot Wings",   wins: 3, losses: 5,  otWins: 0 },
      { team: "Expos",    wins: 5, losses: 3,  otWins: 0 },
      { team: "Bears",     wins: 2, losses: 6, otWins: 1 },
      { team: "Bulls",    wins: 6, losses: 2,  otWins: 0 },
      { team: "Warriors",    wins: 6, losses: 2, otWins: 1 },
      { team: "Revs",   wins: 4, losses: 5,  otWins: 0 },
      { team: "Oilers",   wins: 4, losses: 4, otWins: 1 }
    ];

    // Customize scoring here
    function computePoints(row) {
      return (row.wins * 2) + (row.otWins * 1);
    }

    // State
    let sortKey = "points";
    let sortDir = "desc"; // 'asc' | 'desc'

    // Render table
    function render() {
      const withPts = data.map(d => ({ ...d, points: computePoints(d) }));
      const sorted = [...withPts].sort((a, b) => {
        const A = a[sortKey], B = b[sortKey];
        if (A < B) return sortDir === "asc" ? -1 : 1;
        if (A > B) return sortDir === "asc" ? 1 : -1;
        // Tie-breakers: wins, otWins, losses
        const tiebreakKeys = ["wins", "otWins", "losses"];
        for (const k of tiebreakKeys) {
          if (a[k] !== b[k]) {
            return (a[k] < b[k]) ? (sortDir === "asc" ? -1 : 1)
                                 : (sortDir === "asc" ? 1 : -1);
          }
        }
        return 0;
      });

      const tbody = document.querySelector("#standings tbody");
      tbody.innerHTML = "";
      sorted.forEach((row, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="rank">${i + 1}</td>
          <td class="team">${row.team}</td>
          <td>${row.wins}</td>
          <td>${row.losses}</td>
          <td>${row.otWins}</td>
          <td class="points">${row.points}</td>
        `;
        tbody.appendChild(tr);
      });

      // Update header arrows
      document.querySelectorAll("thead th").forEach(th => th.removeAttribute("data-dir"));
      const th = document.querySelector(`thead button[data-key="${sortKey}"]`)?.parentElement;
      if (th) th.setAttribute("data-dir", sortDir);
    }

    // Events
    document.querySelectorAll("thead button[data-key]").forEach(btn => {
      btn.addEventListener("click", () => {
        const key = btn.getAttribute("data-key");
        if (sortKey === key) {
          sortDir = sortDir === "asc" ? "desc" : "asc";
        } else {
          sortKey = key;
          sortDir = key === "team" ? "asc" : "desc";
        }
        render();
      });
    });

    document.getElementById("resetSort").addEventListener("click", () => {
      sortKey = "points";
      sortDir = "desc";
      render();
    });

    document.getElementById("sortPoints").addEventListener("click", () => {
      sortKey = "points";
      sortDir = "desc";
      render();
    });

    // Init
    render();
  </script>
</body>
</html>
